<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>星評価（ホバーで確定）</title>
    <style>
      .rating {
        display: inline-flex;
        gap: 0.25rem;
      }
      .star {
        font-size: 2.2rem;
        line-height: 1;
        background: none;
        border: none;
        cursor: pointer;
        padding: 0.2rem;
        color: #ccc; /* 未選択 */
        transition: transform 0.05s ease;
      }
      .star.active {
        color: #f5b301;
      } /* 選択済み */
      .star:focus-visible {
        outline: 2px solid #4a90e2;
        border-radius: 0.4rem;
      }
      small.hint {
        display: block;
        color: #666;
        margin-top: 0.25rem;
      }
    </style>
  </head>
  <body>
    <form id="reviewForm">
      <label for="ratingVal">評価：</label>
      <div class="rating" role="radiogroup" aria-label="星評価（ホバーで確定）">
        <input type="hidden" name="rating" id="ratingVal" value="0" />
        <button
          type="button"
          class="star"
          data-value="1"
          role="radio"
          aria-label="1 星"
          aria-checked="false"
        >
          ★
        </button>
        <button
          type="button"
          class="star"
          data-value="2"
          role="radio"
          aria-label="2 星"
          aria-checked="false"
        >
          ★
        </button>
        <button
          type="button"
          class="star"
          data-value="3"
          role="radio"
          aria-label="3 星"
          aria-checked="false"
        >
          ★
        </button>
        <button
          type="button"
          class="star"
          data-value="4"
          role="radio"
          aria-label="4 星"
          aria-checked="false"
        >
          ★
        </button>
        <button
          type="button"
          class="star"
          data-value="5"
          role="radio"
          aria-label="5 星"
          aria-checked="false"
        >
          ★
        </button>
      </div>
      <div
        id="readout"
        aria-live="polite"
        style="display: inline-block; margin-left: 0.5rem"
      >
        未選択
      </div>
      <small class="hint"
        >ヒント：マウスを星に重ねるだけで決まります（クリックでも変更可／← →
        キー対応）</small
      >

      <div style="margin-top: 1rem">
        <button type="submit">送信</button>
        <button type="reset">リセット</button>
      </div>
    </form>

    <script>
      (function () {
        const stars = Array.from(document.querySelectorAll(".star"));
        const input = document.getElementById("ratingVal");
        const readout = document.getElementById("readout");

        function paint(value) {
          stars.forEach((s, i) => {
            const on = i < value;
            s.classList.toggle("active", on);
            s.setAttribute("aria-checked", i + 1 === value ? "true" : "false");
          });
          input.value = value;
          readout.textContent = value ? `${value} / 5` : "未選択";
        }

        // ホバーした瞬間に確定（クリックやタッチでもOK）
        stars.forEach((star) => {
          const v = Number(star.dataset.value);
          star.addEventListener("mouseenter", () => paint(v)); // マウスを重ねるだけで確定
          star.addEventListener("click", () => paint(v)); // クリックでも変更
          star.addEventListener("touchstart", () => paint(v), {
            passive: true,
          }); // タッチ
          star.addEventListener("focus", () => paint(v)); // キーボードでフォーカス
        });

        // キーボード（← →）での変更
        document.querySelector(".rating").addEventListener("keydown", (e) => {
          let v = Number(input.value) || 0;
          if (e.key === "ArrowRight") {
            v = Math.min(5, v + 1);
            paint(v);
            e.preventDefault();
          }
          if (e.key === "ArrowLeft") {
            v = Math.max(0, v - 1);
            paint(v);
            e.preventDefault();
          }
        });

        // リセット時
        document
          .getElementById("reviewForm")
          .addEventListener("reset", () => setTimeout(() => paint(0)));
        // 初期描画
        paint(Number(input.value));
      })();
    </script>
  </body>
</html>
