<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ç¤¾å†…å›³æ›¸é¤¨ã‚·ã‚¹ãƒ†ãƒ </title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
    />

    <link rel="stylesheet" href="/resources/style.css" />
  </head>

  <body>
    <!-- ãƒŠãƒ“ãƒãƒ¼ -->
    <nav class="navbar sticky-top">
      <div
        class="container d-flex flex-wrap justify-content-between align-items-center"
        style="max-width: 1200px; margin: auto"
      >
        <!-- å·¦å´ï¼šã‚·ã‚¹ãƒ†ãƒ å -->
        <div class="col-4 col-md-3">
          <a
            class="navbar-brand fw-bold text-white"
            href="/resources/toppage.html"
          >
            <i class="bi bi-star-fill text-warning"></i>NSLibrary<i
              class="bi bi-star-fill text-warning"
            ></i>
          </a>
        </div>
        <!-- ä¸­å¤®ï¼šæ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆä¼¸ç¸®å¯¾å¿œï¼‰ -->
        <div class="col-12 col-md-6 position-relative px-2">
          <!-- å…¥åŠ›æ¬„ã‚’divã«å¤‰æ›´ã—ã€hidden inputã‚’è¿½åŠ  -->
          <form
            class="d-flex search-form"
            role="search"
            action="/resources/booksearch.html"
          >
            <!-- ãƒãƒƒã‚¸è¡¨ç¤ºé ˜åŸŸã¨å®Ÿéš›ã®å…¥åŠ›æ¬„ã‚’åˆ†ã‘ã‚‹ -->
            <div
              id="badgeInput"
              class="form-control me-2 d-flex flex-wrap align-items-center"
              style="min-height: 38px; cursor: text"
              onclick="searchInput.focus()"
            >
              <!-- ãƒãƒƒã‚¸ãŒã“ã“ã«è¿½åŠ ã•ã‚Œã‚‹ -->
              <input
                id="searchInput"
                type="text"
                class="border-0 flex-grow-1"
                style="outline: none"
                placeholder="æ›¸ç±åãƒ»è‘—è€…åãªã©"
              />
            </div>
            <input type="hidden" name="tags" id="hiddenTags" />
            <button class="btn btn-outline-light" type="submit">
              <i class="bi bi-search"></i>
            </button>
          </form>

          <!-- ã‚¿ã‚°ãƒœã‚¿ãƒ³è¡¨ç¤º -->
          <div
            id="tagContainer"
            class="bg-light border rounded p-3 mt-2 shadow-sm"
            style="display: none; position: absolute; width: 100%; z-index: 10"
          >
            <div class="mb-2 fw-bold">é›£æ˜“åº¦</div>
            <div class="d-flex flex-wrap gap-2 mb-3">
              <button
                type="button"
                class="btn badge-outline rounded-pill btn-sm tag-btn"
              >
                åˆå¿ƒè€…å‘ã‘
              </button>
              <button
                type="button"
                class="btn badge-outline rounded-pill btn-sm tag-btn"
              >
                ä¸­ç´šè€…å‘ã‘
              </button>
              <button
                type="button"
                class="btn badge-outline rounded-pill btn-sm tag-btn"
              >
                ä¸Šç´šè€…å‘ã‘
              </button>
            </div>

            <div class="mb-2 fw-bold">ã‚¸ãƒ£ãƒ³ãƒ«</div>
            <div class="d-flex flex-wrap gap-2 mb-3">
              <button
                type="button"
                class="btn badge-outline rounded-pill btn-sm tag-btn"
              >
                æ–‡å­¦ãƒ»è©•è«–
              </button>
              <button
                type="button"
                class="btn badge-outline rounded-pill btn-sm tag-btn"
              >
                ãƒ“ã‚¸ãƒã‚¹
              </button>
              <button
                type="button"
                class="btn badge-outline rounded-pill btn-sm tag-btn"
              >
                AWS
              </button>
              <button
                type="button"
                class="btn badge-outline rounded-pill btn-sm tag-btn"
              >
                è‡ªå·±å•“ç™º
              </button>
              <button
                type="button"
                class="btn badge-outline rounded-pill btn-sm tag-btn"
              >
                æš®ã‚‰ã—ãƒ»å¥åº·
              </button>
              <button
                type="button"
                class="btn badge-outline rounded-pill btn-sm tag-btn"
              >
                ã‚¢ãƒ¼ãƒˆãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³
              </button>
            </div>

            <div class="mb-2 fw-bold">è·ç¨®</div>
            <div class="d-flex flex-wrap gap-2">
              <button
                type="button"
                class="btn badge-outline rounded-pill btn-sm tag-btn"
              >
                ã‚¤ãƒ³ãƒ•ãƒ©ç³»
              </button>
              <button
                type="button"
                class="btn badge-outline rounded-pill btn-sm tag-btn"
              >
                ã‚¢ãƒ—ãƒª
              </button>
              <button
                type="button"
                class="btn badge-outline rounded-pill btn-sm tag-btn"
              >
                ã‚³ãƒ³ã‚µãƒ«
              </button>
              <button
                type="button"
                class="btn badge-outline rounded-pill btn-sm tag-btn"
              >
                å–¶æ¥­
              </button>
              <button
                type="button"
                class="btn badge-outline rounded-pill btn-sm tag-btn"
              >
                ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ
              </button>
              <button
                type="button"
                class="btn badge-outline rounded-pill btn-sm tag-btn"
              >
                ãƒ‡ãƒ¼ã‚¿
              </button>
            </div>
          </div>
        </div>
        <script>
                        const tagContainer = document.getElementById("tagContainer");
                        const badgeInput = document.getElementById("badgeInput");
                        const hiddenTags = document.getElementById("hiddenTags");

                        searchInput.addEventListener("focus", () => {
                          tagContainer.style.display = "block";
                        });

                        document.addEventListener("click", (event) => {
                          const isClickInside =
                            badgeInput.contains(event.target) ||
                            tagContainer.contains(event.target);
                          if (!isClickInside) {
                            tagContainer.style.display = "none";
                          }
                        });

                        function updateHiddenTags() {
                          const tags = Array.from(
                            badgeInput.querySelectorAll(".tag-badge")
                          ).map((b) => b.dataset.tag);
                          hiddenTags.value = tags.join(" ");
                        }

                        function updateTagButtonStyles() {
                          const selectedTags = Array.from(
                            badgeInput.querySelectorAll(".tag-badge")
                          ).map((b) => b.dataset.tag);

                          document.querySelectorAll(".tag-btn").forEach((button) => {
                            const tag = button.textContent.trim();
                            if (selectedTags.includes(tag)) {
                              button.classList.add("tag-btn-selected");
                            } else {
                              button.classList.remove("tag-btn-selected");
                            }
                          });
                        }

                        function toggleTagBadge(tag) {
                          const existingBadge = Array.from(
                            badgeInput.querySelectorAll(".tag-badge")
                          ).find((b) => b.dataset.tag === tag);

                          if (existingBadge) {
                            existingBadge.remove();
                          } else {
                            const badge = document.createElement("span");
                            badge.className =
                              "badge rounded-pill badge-outline me-1 tag-badge";
                            badge.dataset.tag = tag;
                            badge.innerHTML = `${tag} <span class="ms-1 remove-btn" style="cursor:pointer;">&times;</span>`;

                            badge
                              .querySelector(".remove-btn")
                              .addEventListener("click", (event) => {
                                event.stopPropagation();
                                badge.remove();
                                updateHiddenTags();
                                updateTagButtonStyles();
                              });

                            badgeInput.insertBefore(badge, searchInput);
                          }

                          updateHiddenTags();
                          updateTagButtonStyles();
                        }

                        document.querySelectorAll(".tag-btn").forEach((button) => {
                          button.addEventListener("click", () => {
                            const tag = button.textContent.trim();
                            toggleTagBadge(tag);
                          });
                        });
                        searchInput.addEventListener("keydown", (event) => {
                          if (
                            event.key === "Backspace" &&
                            searchInput.value === "" // å…¥åŠ›æ¬„ãŒç©ºã®ã¨ã
                          ) {
                            const tagBadges = badgeInput.querySelectorAll(".tag-badge");
                            if (tagBadges.length > 0) {
                              const lastBadge = tagBadges[tagBadges.length - 1];
                              lastBadge.remove();
                              updateHiddenTags();
                              updateTagButtonStyles();
                            }
                          }
                        });
                        document
                          .querySelector(".search-form")
                          .addEventListener("submit", (event) => {
                            event.preventDefault(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®é€ä¿¡ã‚’é˜²æ­¢
                            // ã‚¿ã‚°åã¨ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒƒãƒ”ãƒ³ã‚°
                            const tagQueryMap = {
                              åˆå¿ƒè€…å‘ã‘: "1",
                              ä¸­ç´šè€…å‘ã‘: "2",
                              ä¸Šç´šè€…å‘ã‘: "3",
                              æ–‡å­¦ãƒ»è©•è«–: "4",
                              ãƒ“ã‚¸ãƒã‚¹: "5",
                              AWS: "6",
                              è‡ªå·±å•“ç™º: "7",
                              æš®ã‚‰ã—ãƒ»å¥åº·: "8",
                              ã‚¢ãƒ¼ãƒˆãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³: "9",
                              ã‚¤ãƒ³ãƒ•ãƒ©ç³»: "10",
                              ã‚¢ãƒ—ãƒª: "11",
                              ã‚³ãƒ³ã‚µãƒ«: "12",
                              å–¶æ¥­: "13",
                              ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ: "14",
                              ãƒ‡ãƒ¼ã‚¿: "15",
                              // å¿…è¦ã«å¿œã˜ã¦è¿½åŠ 
                            };
                            // é¸æŠã•ã‚ŒãŸã‚¿ã‚°ã‚’å–å¾—
                  const selectedTags = Array.from(
                    document.querySelectorAll(".tag-badge")
                  ).map((badge) => badge.dataset.tag);

                  // å¯¾å¿œã™ã‚‹IDã‚’å–å¾—
                  const selectedIds = selectedTags
                    .map((tag) => tagQueryMap[tag])
                    .filter((id) => id !== undefined);

                  // ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
                  const queryString = selectedIds.length > 0 ? `?tags=${selectedIds.join(",")}` : "";

                  // URLã‚’è¨­å®šã—ã¦é€ä¿¡
                  const form = event.target;
                  const targetUrl = `/resources/booksearch.html${queryString}`;
                  window.location.href = targetUrl;
                          });
                    document.addEventListener("DOMContentLoaded", () => {
            const params = new URLSearchParams(window.location.search);
            const tagsParam = params.get("tags");

            if (tagsParam) {
              const selectedIds = tagsParam.split(",");
              const idTagMap = {
                1: "åˆå¿ƒè€…å‘ã‘",
                2: "ä¸­ç´šè€…å‘ã‘",
                3: "ä¸Šç´šè€…å‘ã‘",
                4: "æ–‡å­¦ãƒ»è©•è«–",
                5: "ãƒ“ã‚¸ãƒã‚¹",
                6: "AWS",
                7: "è‡ªå·±å•“ç™º",
                8: "æš®ã‚‰ã—ãƒ»å¥åº·",
                9: "ã‚¢ãƒ¼ãƒˆãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³",
                10: "ã‚¤ãƒ³ãƒ•ãƒ©ç³»",
                11: "ã‚¢ãƒ—ãƒª",
                12: "ã‚³ãƒ³ã‚µãƒ«",
                13: "å–¶æ¥­",
                14: "ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ",
                15: "ãƒ‡ãƒ¼ã‚¿"
              };

              selectedIds.forEach((id) => {
                const tag = idTagMap[id];
                if (tag) {
                  toggleTagBadge(tag); // æ—¢å­˜é–¢æ•°ã‚’å†åˆ©ç”¨
                }
              });
            }
          });
        </script>

        <!-- å³å´ï¼šè²¸å‡ºå±¥æ­´è¡¨ç¤º -->
        <div class="d-flex align-items-center gap-1">
          <a
            href="/resources/booklog.html"
            class="d-flex align-items-center text-decoration-none hover-outline rounded px-2"
          >
            <i class="bi bi-book fs-5 text-white me-2"></i>
            <span class="text-white fw-light">è²¸å‡ºå±¥æ­´</span>
          </a>
          <a
            href="/resources/mypage.html"
            class="d-flex align-items-center text-decoration-none hover-outline rounded px-2"
          >
            <i class="bi bi-person-circle fs-5 text-white me-2"></i>
            <span id="loginMember" class="text-white fw-light"></span>
          </a>
        </div>
      </div>
    </nav>

    <!-- ã‚¿ã‚¤ãƒˆãƒ«ã¨ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‚’åŒã˜æ®µã«è¡¨ç¤º -->
    <div class="container mt-4 mb-4" style="max-width: 1200px">
      <div class="position-relative">
        <!-- ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä¸­å¤®æƒãˆï¼‰ -->
        <h1 class="text-center">
          <span id="selectedCategory"></span>ã®æ¤œç´¢çµæœï¼ˆ<span
            id="resultBooksNumber"
          ></span
          >ä»¶ï¼‰
        </h1>

        <!-- ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆå³ä¸Šã«é…ç½®ã€PCè¡¨ç¤ºï¼‰ -->
        <div class="d-none d-md-block position-absolute top-0 end-0 mt-2 me-2">
          <select
            class="form-select form-select w-auto"
            id="sortSelect"
            onchange="handleSortChange()"
          >
            <option value="none" selected>ãŠã™ã™ã‚é †</option>
            <option value="high">è©•ä¾¡ã®é«˜ã„é †</option>
            <option value="low">è©•ä¾¡ã®ä½ã„é †</option>
          </select>
        </div>

        <!-- ã‚¹ãƒãƒ›ç”¨ï¼šä¸‹ã«è¡¨ç¤ºï¼ˆå³å¯„ã›ï¼‰ -->
        <div class="d-block d-md-none mt-3">
          <div class="d-flex justify-content-end w-100">
            <select
              class="form-select form-select w-auto"
              id="sortSelectMobile"
              onchange="handleSortChange()"
            >
              <option value="none" selected>ãŠã™ã™ã‚é †</option>
              <option value="high">è©•ä¾¡ã®é«˜ã„é †</option>
              <option value="low">è©•ä¾¡ã®ä½ã„é †</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- æ¤œç´¢çµæœã‚«ãƒ¼ãƒ‰ -->
    <div id="searchResult" class="container"></div>

    <!-- å€Ÿã‚Šã‚‹ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div
      class="modal fade"
      id="borrowModal"
      tabindex="-1"
      aria-labelledby="borrowModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="borrowModalLabel">ç¢ºèªç”»é¢</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="é–‰ã˜ã‚‹"
            ></button>
          </div>
          <div class="modal-body">
            <p><strong>ã“ã®æœ¬ã‚’å€Ÿã‚Šã¾ã™ã‹ï¼Ÿ</strong></p>
            <strong>ã‚¿ã‚¤ãƒˆãƒ«ï¼š</strong>
            å›³è§£AWSã®ä»•çµ„ã¿ã¨ã‚µãƒ¼ãƒ“ã‚¹ãŒã‚ˆãåˆ†ã‹ã‚‹ï¼
          </div>

          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            </button>
            <button
              type="button"
              class="btn btn-success"
              data-bs-target="#borrowResultModal"
              data-bs-toggle="modal"
              data-bs-dismiss="modal"
            >
              å€Ÿã‚Šã‚‹
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- å€Ÿã‚ŠãŸçµæœãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div
      class="modal fade"
      id="borrowResultModal"
      tabindex="-1"
      aria-labelledby="borrowResultModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="borrowResultModalLabel">
              ä»¥ä¸‹ã®æœ¬ã‚’å€Ÿã‚Šã¾ã—ãŸ
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="é–‰ã˜ã‚‹"
            ></button>
          </div>
          <div class="modal-body">
            <p>
              <strong>ã‚¿ã‚¤ãƒˆãƒ«ï¼š</strong>
              å›³è§£AWSã®ä»•çµ„ã¿ã¨ã‚µãƒ¼ãƒ“ã‚¹ãŒã‚ˆãåˆ†ã‹ã‚‹ï¼
            </p>

            <strong>è¿”å´æœŸé™ï¼š</strong> 2025/09/30
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-primary"
              data-bs-dismiss="modal"
            >
              é–‰ã˜ã‚‹
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ãŸã‚ã¨ã«ãƒšãƒ¼ã‚¸é·ç§»
      const closeBtn = document.getElementById("closeAndRedirectBtn");
      const modalElement = document.getElementById("borrowResultModal");

      modalElement.addEventListener("hidden.bs.modal", function () {
        window.location.href = "/resources/Borrowed/booksearch.html";
      });
    </script>
    <script>
                  document.addEventListener("DOMContentLoaded", function () {
                    const badges = document.querySelectorAll(".badge");

                    badges.forEach(function (badge) {
                      if (badge.textContent.trim() === "åˆå¿ƒè€…å‘ã‘") {
                        badge.style.cursor = "pointer"; // è¦‹ãŸç›®ã§ã‚¯ãƒªãƒƒã‚¯ã§ãã‚‹ã“ã¨ã‚’ç¤ºã™
                        badge.addEventListener("click", function () {
                          window.location.href = "booksearchEasy.html";
                        });
                      }
                      if (badge.textContent.trim() === "AWS") {
                        badge.style.cursor = "pointer"; // è¦‹ãŸç›®ã§ã‚¯ãƒªãƒƒã‚¯ã§ãã‚‹ã“ã¨ã‚’ç¤ºã™
                        badge.addEventListener("click", function () {
                          window.location.href = "booksearch.html";
                        });
                      }
                    });
                  });

                  /**
                   * æ¤œç´¢çµæœã®æ›¸ç±ã‚’è¡¨ç¤º
                   */
                  // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ã‚«ãƒ†ã‚´ãƒªIDã‚’å–å¾—
                  const params = new URLSearchParams(window.location.search);
                  const tagIds = (params.get("tags") || "")
                    .split(",")
                    .map((id) => parseInt(id))
                    .filter((id) => !isNaN(id));

                  // æ›¸ç±ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
                  Promise.all([
                    fetch("http://localhost:3000/books").then((res) => res.json()),
                    fetch("http://localhost:3000/categories").then((res) => res.json()),
                  ])
                    .then(([books, categories]) => {
                      const container = document.getElementById("searchResult");
                      container.innerHTML = "";

                      // categories ã‚’ id: name ã®ãƒãƒƒãƒ—ã«ã™ã‚‹
                      const categoryMap = {};
                      categories.forEach((cat) => {
                        categoryMap[cat.id] = cat.category;
                      });

                      // ğŸ”¹ é¸æŠã•ã‚ŒãŸã‚¿ã‚°IDã‚’ã™ã¹ã¦å«ã‚€æœ¬ã ã‘æ®‹ã™ (ANDæ¤œç´¢)
                      let filteredBooks = books;
                      if (tagIds.length > 0) {
                        filteredBooks = books.filter((book) =>
                          tagIds.every((tagId) => book.category.includes(tagId))
                        );
                      }

                      filteredBooks.forEach((book) => {
                        // æ˜Ÿã‚¢ã‚¤ã‚³ãƒ³
                        const stars = [];
                        const fullStars = Math.floor(book.stars);
                        const hasHalf = book.stars % 1 !== 0;

                        for (let i = 0; i < fullStars; i++) {
                          stars.push('<i class="bi bi-star-fill text-warning"></i>');
                        }
                        if (hasHalf)
                          stars.push('<i class="bi bi-star-half text-warning"></i>');
                        while (stars.length < 5) {
                          stars.push('<i class="bi bi-star text-warning"></i>');
                        }

                        // è²¸å‡ºçŠ¶æ³ï¼ˆ-1ã¯éè¡¨ç¤ºï¼‰
                        const libraryStatus = [
                          { name: "è™ãƒé–€", status: book.library1 },
                          { name: "æ–°å·", status: book.library2 },
                          { name: "ã¿ãªã¨ã¿ã‚‰ã„", status: book.library3 },
                        ]
                          .filter((lib) => lib.status !== "-1")
                          .map(
                            (lib) => `
                      <div class="d-flex justify-content-between align-items-center border-bottom py-2">
                        <span>${lib.name}</span>
                        <span class="badge ${
                          lib.status === "1" ? "bg-success" : "bg-danger"
                        } badge-fixed"
                          ${
                            lib.status === "1"
                              ? 'data-bs-toggle="modal" data-bs-target="#borrowModal"'
                              : ""
                          }>
                          ${lib.status === "1" ? "å€Ÿã‚Šã‚‹" : "è²¸å‡ºä¸­"}
                        </span>
                      </div>
                    `
                          )
                          .join("");

                        // ã‚«ãƒ†ã‚´ãƒªï¼ˆè¤‡æ•°å¯¾å¿œï¼‰
                        const categoryBadges = (book.category || [])
                          .map((catId) => {
                            const name = categoryMap[catId];
                            return name
                              ? `<span class="badge rounded-pill badge-outline me-1 category-badge"
                            data-tag="${name}" data-id="${catId}">${name}</span>`
                              : "";
                          })
                          .join("");

                        // ã‚«ãƒ¼ãƒ‰HTML
                        const card = `
                    <div class="card card-hover search-card mb-4 shadow-sm border-0"
                          onclick="window.location.href='bookDetail.html?id=${book.id}'"
                          style="cursor: pointer;">
                      <div class="row g-0 align-items-stretch">
                        <!-- ç”»åƒ -->
                        <div class="col-md-3 d-flex justify-content-center align-items-center py-2 px-1 border-end">
                          <img src="${
                            book.image
                          }" class="img-fluid rounded" alt="è”µæ›¸ç”»åƒ" />
                        </div>

                        <!-- ã‚¿ã‚¤ãƒˆãƒ«ãƒ»è©•ä¾¡ãƒ»ã‚«ãƒ†ã‚´ãƒª -->
                        <div class="col-md-6 p-3 border-end text-block">
                          <h4 class="fw-bold mb-2 title-clamp-2">${book.title}</h4>
                          <p class="rating mb-2">
                            <strong>è©•ä¾¡ï¼š</strong>
                            ${stars.join("")}
                            <span class="text-muted small mx-1">${book.stars} (${
                          book.reviews
                        }ä»¶)</span>
                          </p>
                          <p class="card-text tag-group">${categoryBadges}</p>
                        </div>

                        <!-- è²¸å‡ºçŠ¶æ³ -->
                        <div class="col-md-3 d-flex flex-column justify-content-center p-3">
                          ${libraryStatus}
                        </div>
                      </div>
                    </div>
                  `;

                        container.insertAdjacentHTML("beforeend", card);
                      });

                      // è©²å½“æ›¸ç±ãªã—
                      if (filteredBooks.length === 0) {
                        container.innerHTML =
                          "<p class='text-muted'>è©²å½“ã™ã‚‹æœ¬ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>";
                      }

            // ã‚«ãƒ¼ãƒ‰æç”»å¾Œã«é¸æŠæ¸ˆã¿ã‚¿ã‚°ã‚’åæ˜ ã™ã‚‹é–¢æ•°
            function updateCategoryBadgeStyles() {
              const selectedTags = Array.from(
                document.querySelectorAll(".tag-badge")
              ).map((b) => b.dataset.tag);

              document.querySelectorAll(".category-badge").forEach((badge) => {
                if (selectedTags.includes(badge.dataset.tag)) {
                  badge.classList.remove("badge-outline");
                  badge.classList.add("bg-primary", "text-white");
                } else {
                  badge.classList.add("badge-outline");
                  badge.classList.remove("bg-primary", "text-white");
                }
              });
            }

                  // ã‚«ãƒ¼ãƒ‰ç”ŸæˆãŒçµ‚ã‚ã£ãŸã‚ã¨ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä»˜ä¸
                  document.querySelectorAll(".category-badge").forEach((badge) => {
                    badge.addEventListener("click", (event) => {
                      event.stopPropagation(); // ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯é·ç§»ã‚’é˜²æ­¢
                      const tag = badge.dataset.tag;
                      toggleTagBadge(tag); // æ¤œç´¢çª“ã«è¿½åŠ 

                      // ç¾åœ¨ã®ã‚¿ã‚°ä¸€è¦§ã‚’IDã«å¤‰æ›
                      const tagQueryMap = {
                        åˆå¿ƒè€…å‘ã‘: "1",
                        ä¸­ç´šè€…å‘ã‘: "2",
                        ä¸Šç´šè€…å‘ã‘: "3",
                        æ–‡å­¦ãƒ»è©•è«–: "4",
                        ãƒ“ã‚¸ãƒã‚¹: "5",
                        AWS: "6",
                        è‡ªå·±å•“ç™º: "7",
                        æš®ã‚‰ã—ãƒ»å¥åº·: "8",
                        ã‚¢ãƒ¼ãƒˆãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³: "9",
                        ã‚¤ãƒ³ãƒ•ãƒ©ç³»: "10",
                        ã‚¢ãƒ—ãƒª: "11",
                        ã‚³ãƒ³ã‚µãƒ«: "12",
                        å–¶æ¥­: "13",
                        ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ: "14",
                        ãƒ‡ãƒ¼ã‚¿: "15",
                      };

                      const selectedTags = Array.from(
                        document.querySelectorAll(".tag-badge")
                      ).map((b) => b.dataset.tag);

                      const selectedIds = selectedTags
                        .map((t) => tagQueryMap[t])
                        .filter((id) => id !== undefined);

                      const queryString =
                        selectedIds.length > 0 ? `?tags=${selectedIds.join(",")}` : "";

                      // å³æ™‚ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆå†æ¤œç´¢ï¼‰
                      window.location.href = `/resources/booksearch.html${queryString}`;
                    });
                  });

      // ã‚«ãƒ¼ãƒ‰ç”ŸæˆãŒçµ‚ã‚ã£ãŸã‚ã¨ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä»˜ä¸
      document.querySelectorAll(".category-badge").forEach((badge) => {
        badge.addEventListener("click", (event) => {
          event.stopPropagation();
          const tag = badge.dataset.tag;
          toggleTagBadge(tag);

          // ã‚¿ã‚°è¿½åŠ å¾Œã«ã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°
          updateCategoryBadgeStyles();

          // é·ç§»å‡¦ç†
          const selectedTags = Array.from(
            document.querySelectorAll(".tag-badge")
          ).map((b) => b.dataset.tag);
          const selectedIds = selectedTags
            .map((t) => tagQueryMap[t])
            .filter((id) => id !== undefined);
          const queryString =
            selectedIds.length > 0 ? `?tags=${selectedIds.join(",")}` : "";
          window.location.href = `/resources/booksearch.html${queryString}`;
        });
      });

      // æœ€åˆã®æç”»æ™‚ç‚¹ã§ã‚‚åæ˜ 
      updateCategoryBadgeStyles();
                          })
                          .catch((err) => console.error("ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:", err));

                        /**
                         * ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¡¨ç¤º
                         */
                        const memberId = 7;
                        const booksEndpoint = `http://localhost:3000/members/${memberId}`;
                        fetch(booksEndpoint)
                          .then((res) => res.json())
                          .then((member) => {
                            document.getElementById("loginMember").textContent = member.name;
                          });

                        /**
                         * æ¤œç´¢çµæœã®ã‚«ãƒ†ã‚´ãƒªè¡¨ç¤º
                         */
                        fetch("http://localhost:3000/categories")
                          .then((res) => res.json())
                          .then((categories) => {
                            const params = new URLSearchParams(window.location.search);
                            const tagIds = (params.get("tags") || "")
                              .split(",")
                              .map((id) => parseInt(id, 10))
                              .filter((id) => !isNaN(id));

                            const selectedNames = categories
                              .filter((cat) => tagIds.includes(Number(cat.id))) // ğŸ”¹ã“ã“ã‚’ä¿®æ­£
                              .map((cat) => `ã€Œ${cat.category}ã€`);

                            document.getElementById("selectedCategory").textContent =
                              selectedNames.join("") || "ã™ã¹ã¦";
                          });

                        /**
                         * è¡¨ç¤ºä»¶æ•°
                         */
                        fetch("http://localhost:3000/books")
                          .then((res) => res.json())
                          .then((books) => {
                            const params = new URLSearchParams(window.location.search);
                            const tagIds = (params.get("tags") || "")
                              .split(",")
                              .map((id) => parseInt(id))
                              .filter((id) => !isNaN(id));

                            let filteredBooks = books;
                            if (tagIds.length > 0) {
                              filteredBooks = books.filter((book) =>
                                tagIds.every((tagId) => book.category.includes(tagId))
                              );
                            }

                            document.getElementById("resultBooksNumber").textContent =
                              filteredBooks.length;
                          });
    </script>
  </body>
</html>
